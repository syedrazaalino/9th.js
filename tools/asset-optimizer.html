<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Optimizer - Developer Tools Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }

        .toolbar {
            background: #2d2d2d;
            padding: 10px 20px;
            border-bottom: 1px solid #444;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toolbar h1 {
            font-size: 18px;
            color: #00ff88;
            margin-right: 30px;
        }

        .tool-btn {
            background: #404040;
            border: 1px solid #555;
            color: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background: #505050;
            border-color: #00ff88;
        }

        .tool-btn.active {
            background: #00ff88;
            color: #000;
        }

        .tool-btn:disabled {
            background: #2a2a2a;
            color: #666;
            cursor: not-allowed;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 50px);
        }

        .sidebar {
            width: 250px;
            background: #2d2d2d;
            border-right: 1px solid #444;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            color: #00ff88;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 15px 15px 0 15px;
        }

        .upload-panel {
            padding: 15px;
            border-bottom: 1px solid #444;
        }

        .upload-zone {
            border: 2px dashed #555;
            border-radius: 4px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        .upload-icon {
            font-size: 24px;
            color: #666;
            margin-bottom: 10px;
        }

        .asset-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .asset-item {
            background: #3a3a3a;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .asset-item:hover {
            background: #454545;
            border-color: #555;
        }

        .asset-item.selected {
            border-color: #00ff88;
            background: #404040;
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .asset-name {
            font-weight: 600;
            color: #fff;
        }

        .asset-type {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 2px;
            background: #555;
            color: #fff;
        }

        .asset-info {
            font-size: 11px;
            color: #999;
            display: flex;
            justify-content: space-between;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            flex-direction: column;
        }

        .preview-tabs {
            background: #2d2d2d;
            display: flex;
            border-bottom: 1px solid #444;
        }

        .preview-tab {
            padding: 10px 20px;
            background: #3a3a3a;
            border-right: 1px solid #444;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .preview-tab.active {
            background: #00ff88;
            color: #000;
        }

        .preview-content {
            flex: 1;
            display: flex;
            position: relative;
        }

        .preview-canvas-wrapper {
            flex: 1;
            position: relative;
            background: #111;
        }

        .preview-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .comparison-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .before-after {
            display: flex;
            height: 50%;
            margin-bottom: 10px;
        }

        .before-after img {
            flex: 1;
            object-fit: contain;
            background: #111;
        }

        .comparison-divider {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #00ff88;
            cursor: ew-resize;
            pointer-events: auto;
        }

        .property-panel {
            width: 300px;
            background: #2d2d2d;
            border-left: 1px solid #444;
            display: flex;
            flex-direction: column;
        }

        .properties-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
            display: block;
        }

        .property-input {
            width: 100%;
            background: #3a3a3a;
            border: 1px solid #555;
            color: #fff;
            padding: 6px 10px;
            border-radius: 3px;
            font-size: 12px;
        }

        .property-input[type="range"] {
            padding: 0;
        }

        .property-input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .property-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .property-row .property-input {
            flex: 1;
        }

        .optimization-controls {
            padding: 15px;
            border-top: 1px solid #444;
            background: #252525;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #00ff88;
            transition: width 0.3s;
            width: 0%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: #3a3a3a;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #00ff88;
        }

        .stat-label {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
        }

        .optimization-results {
            margin-top: 15px;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 4px;
            display: none;
        }

        .optimization-results.show {
            display: block;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 11px;
        }

        .result-label {
            color: #999;
        }

        .result-value {
            color: #00ff88;
            font-weight: 600;
        }

        .result-value.improved {
            color: #00ff88;
        }

        .result-value.degraded {
            color: #ff4444;
        }

        .asset-preview {
            width: 50px;
            height: 50px;
            border-radius: 3px;
            object-fit: cover;
            margin-right: 8px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #333;
            border-top: 2px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .texture-settings {
            display: none;
        }

        .texture-settings.show {
            display: block;
        }

        .mesh-settings {
            display: none;
        }

        .mesh-settings.show {
            display: block;
        }

        .format-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .format-option {
            padding: 4px 8px;
            background: #3a3a3a;
            border: 1px solid #555;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .format-option:hover {
            background: #454545;
        }

        .format-option.selected {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <h1>üóúÔ∏è Asset Optimizer</h1>
        <button class="tool-btn" onclick="optimizer.selectAllAssets()">Select All</button>
        <button class="tool-btn" onclick="optimizer.optimizeSelected()" id="optimizeBtn">Optimize Selected</button>
        <button class="tool-btn" onclick="optimizer.batchOptimize()" id="batchBtn">Batch Optimize</button>
        <button class="tool-btn" onclick="optimizer.exportOptimized()" id="exportBtn">Export</button>
        <button class="tool-btn" onclick="optimizer.resetView()">Reset</button>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="section-title">Assets</div>
            <div class="upload-panel">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üìÅ</div>
                    <div style="font-size: 12px; color: #999;">Click or drag files here</div>
                    <input type="file" id="fileInput" multiple accept=".png,.jpg,.jpeg,.webp,.obj,.fbx,.gltf,.glb,.dae,.3ds,.mesh" style="display: none;">
                </div>
            </div>
            <div class="asset-list" id="assetList"></div>
        </div>

        <div class="canvas-container">
            <div class="preview-tabs">
                <div class="preview-tab active" data-tab="original">Original</div>
                <div class="preview-tab" data-tab="optimized">Optimized</div>
                <div class="preview-tab" data-tab="comparison">Comparison</div>
                <div class="preview-tab" data-tab="statistics">Statistics</div>
            </div>
            
            <div class="preview-content">
                <div class="preview-canvas-wrapper" id="previewWrapper">
                    <canvas id="previewCanvas" class="preview-canvas"></canvas>
                    <div class="comparison-overlay" id="comparisonOverlay" style="display: none;">
                        <div class="before-after">
                            <img id="beforeImage" alt="Before">
                            <img id="afterImage" alt="After">
                        </div>
                        <div class="comparison-divider" id="comparisonDivider" style="left: 50%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="property-panel">
            <div class="section-title">Optimization Settings</div>
            <div class="properties-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="assetCount">0</div>
                        <div class="stat-label">Assets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSize">0 MB</div>
                        <div class="stat-label">Total Size</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="savingsPercent">0%</div>
                        <div class="stat-label">Savings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="optimizedCount">0</div>
                        <div class="stat-label">Optimized</div>
                    </div>
                </div>

                <div class="property-group">
                    <div class="property-label">Asset Type</div>
                    <div class="format-options" id="assetTypeDisplay">
                        <div class="format-option">Select an asset</div>
                    </div>
                </div>

                <div class="texture-settings" id="textureSettings">
                    <div class="property-group">
                        <label class="property-label">Texture Quality</label>
                        <input type="range" class="property-input" min="10" max="100" value="80" id="qualitySlider">
                        <span id="qualityValue" style="font-size: 11px; color: #00ff88;">80%</span>
                    </div>

                    <div class="property-group">
                        <label class="property-label">Resize Dimensions</label>
                        <div class="property-row">
                            <input type="number" class="property-input" placeholder="Width" id="textureWidth">
                            <input type="number" class="property-input" placeholder="Height" id="textureHeight">
                        </div>
                        <div style="margin-top: 5px;">
                            <label style="font-size: 11px; color: #999;">
                                <input type="checkbox" id="maintainAspectRatio" checked> Maintain aspect ratio
                            </label>
                        </div>
                    </div>

                    <div class="property-group">
                        <label class="property-label">Output Format</label>
                        <div class="format-options" id="textureFormatOptions">
                            <div class="format-option selected" data-format="original">Original</div>
                            <div class="format-option" data-format="webp">WebP</div>
                            <div class="format-option" data-format="jpeg">JPEG</div>
                            <div class="format-option" data-format="png">PNG</div>
                        </div>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="removeAlpha"> Remove alpha channel
                        </label>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="generateMipmaps"> Generate mipmaps
                        </label>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="losslessCompression"> Lossless compression
                        </label>
                    </div>
                </div>

                <div class="mesh-settings" id="meshSettings">
                    <div class="property-group">
                        <label class="property-label">Simplification Level</label>
                        <input type="range" class="property-input" min="0" max="100" value="50" id="simplificationSlider">
                        <span id="simplificationValue" style="font-size: 11px; color: #00ff88;">50%</span>
                    </div>

                    <div class="property-group">
                        <label class="property-label">Vertex Precision</label>
                        <select class="property-input" id="vertexPrecision">
                            <option value="full">Full (32-bit)</option>
                            <option value="half">Half (16-bit)</option>
                            <option value="quantized">Quantized (8-bit)</option>
                        </select>
                    </div>

                    <div class="property-group">
                        <label class="property-label">Compression</label>
                        <div class="format-options" id="meshCompressionOptions">
                            <div class="format-option selected" data-format="none">None</div>
                            <div class="format-option" data-format="draco">Draco</div>
                            <div class="format-option" data-format="meshopt">MeshOpt</div>
                        </div>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="mergeVertices"> Merge duplicate vertices
                        </label>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="removeDegenerate"> Remove degenerate faces
                        </label>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="generateNormals"> Generate normals
                        </label>
                    </div>

                    <div class="property-group">
                        <label style="font-size: 11px; color: #999;">
                            <input type="checkbox" id="optimizeIndices"> Optimize indices
                        </label>
                    </div>
                </div>
            </div>

            <div class="optimization-controls">
                <button class="tool-btn" onclick="optimizer.previewOptimization()" style="width: 100%; margin-bottom: 10px;" id="previewBtn">
                    Preview Changes
                </button>
                <button class="tool-btn" onclick="optimizer.applyOptimization()" style="width: 100%; margin-bottom: 10px;" id="applyBtn">
                    Apply Optimization
                </button>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div class="optimization-results" id="optimizationResults">
                    <div class="result-item">
                        <span class="result-label">Original Size:</span>
                        <span class="result-value" id="originalSizeResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Optimized Size:</span>
                        <span class="result-value" id="optimizedSizeResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Size Reduction:</span>
                        <span class="result-value improved" id="sizeReductionResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Quality Impact:</span>
                        <span class="result-value" id="qualityImpactResult">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AssetOptimizer {
            constructor() {
                this.assets = [];
                this.selectedAssets = new Set();
                this.currentAsset = null;
                this.optimizedAssets = new Map();
                this.isOptimizing = false;
                this.progress = 0;

                this.init();
                this.setupEventListeners();
            }

            init() {
                this.setupUploadZone();
                this.setupPreviewCanvas();
                this.setupComparisonControls();
                this.addDemoAssets();
            }

            setupUploadZone() {
                const uploadZone = document.getElementById('uploadZone');
                const fileInput = document.getElementById('fileInput');

                uploadZone.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => this.handleFileUpload(e.target.files));

                // Drag and drop
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });

                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });

                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    this.handleFileUpload(e.dataTransfer.files);
                });
            }

            setupPreviewCanvas() {
                this.previewCanvas = document.getElementById('previewCanvas');
                this.previewCtx = this.previewCanvas.getContext('2d');
                this.resizePreviewCanvas();
                window.addEventListener('resize', () => this.resizePreviewCanvas());
            }

            setupComparisonControls() {
                const divider = document.getElementById('comparisonDivider');
                let isDragging = false;

                divider.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        const wrapper = document.getElementById('previewWrapper');
                        const rect = wrapper.getBoundingClientRect();
                        const x = Math.max(0, Math.min(rect.width, e.clientX - rect.left));
                        const percentage = (x / rect.width) * 100;
                        divider.style.left = percentage + '%';
                        document.getElementById('beforeImage').style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.preview-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.switchPreviewTab(tab.dataset.tab);
                    });
                });

                // Settings controls
                document.getElementById('qualitySlider').addEventListener('input', (e) => {
                    document.getElementById('qualityValue').textContent = e.target.value + '%';
                });

                document.getElementById('simplificationSlider').addEventListener('input', (e) => {
                    document.getElementById('simplificationValue').textContent = e.target.value + '%';
                });

                // Format selection
                document.querySelectorAll('.format-option').forEach(option => {
                    option.addEventListener('click', () => {
                        option.parentElement.querySelectorAll('.format-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                    });
                });
            }

            addDemoAssets() {
                const demoAssets = [
                    {
                        id: 'tex1',
                        name: 'texture.png',
                        type: 'texture',
                        size: 2048,
                        width: 1024,
                        height: 1024,
                        originalSize: 2097152,
                        url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=='
                    },
                    {
                        id: 'mesh1',
                        name: 'character.obj',
                        type: 'mesh',
                        size: 1024,
                        vertices: 1000,
                        faces: 500,
                        originalSize: 524288,
                        url: null
                    }
                ];

                demoAssets.forEach(asset => this.addAsset(asset));
            }

            handleFileUpload(files) {
                Array.from(files).forEach(file => {
                    const asset = {
                        id: 'asset_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        name: file.name,
                        type: this.detectAssetType(file.name),
                        size: file.size,
                        originalSize: file.size,
                        file: file,
                        url: file.type.startsWith('image/') ? URL.createObjectURL(file) : null
                    };

                    this.addAsset(asset);
                });
            }

            detectAssetType(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                const imageTypes = ['png', 'jpg', 'jpeg', 'webp', 'gif', 'bmp'];
                const meshTypes = ['obj', 'fbx', 'gltf', 'glb', 'dae', '3ds', 'mesh'];
                
                if (imageTypes.includes(ext)) return 'texture';
                if (meshTypes.includes(ext)) return 'mesh';
                return 'unknown';
            }

            addAsset(asset) {
                this.assets.push(asset);
                this.updateAssetList();
                this.updateStats();
            }

            updateAssetList() {
                const list = document.getElementById('assetList');
                list.innerHTML = '';

                this.assets.forEach(asset => {
                    const item = document.createElement('div');
                    item.className = 'asset-item';
                    item.dataset.assetId = asset.id;

                    if (asset === this.currentAsset) {
                        item.classList.add('selected');
                    }

                    item.onclick = () => this.selectAsset(asset);

                    const header = document.createElement('div');
                    header.className = 'asset-header';

                    const name = document.createElement('div');
                    name.className = 'asset-name';
                    name.textContent = asset.name;

                    const type = document.createElement('div');
                    type.className = 'asset-type';
                    type.textContent = asset.type;

                    header.appendChild(name);
                    header.appendChild(type);

                    const info = document.createElement('div');
                    info.className = 'asset-info';

                    const size = document.createElement('span');
                    size.textContent = this.formatBytes(asset.size);

                    const details = document.createElement('span');
                    if (asset.type === 'texture') {
                        details.textContent = `${asset.width || '?'}√ó${asset.height || '?'}`;
                    } else if (asset.type === 'mesh') {
                        details.textContent = `${asset.vertices || '?'}v/${asset.faces || '?'}f`;
                    } else {
                        details.textContent = asset.type;
                    }

                    info.appendChild(size);
                    info.appendChild(details);

                    item.appendChild(header);
                    item.appendChild(info);

                    list.appendChild(item);
                });
            }

            selectAsset(asset) {
                this.currentAsset = asset;
                document.querySelectorAll('.asset-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.querySelector(`[data-asset-id="${asset.id}"]`).classList.add('selected');
                
                this.updatePropertyPanel();
                this.updatePreview();
            }

            updatePropertyPanel() {
                const assetTypeDisplay = document.getElementById('assetTypeDisplay');
                const textureSettings = document.getElementById('textureSettings');
                const meshSettings = document.getElementById('meshSettings');

                assetTypeDisplay.innerHTML = `
                    <div class="format-option selected">${this.currentAsset.type.toUpperCase()}</div>
                `;

                if (this.currentAsset.type === 'texture') {
                    textureSettings.classList.add('show');
                    meshSettings.classList.remove('show');
                } else if (this.currentAsset.type === 'mesh') {
                    meshSettings.classList.add('show');
                    textureSettings.classList.remove('show');
                } else {
                    textureSettings.classList.remove('show');
                    meshSettings.classList.remove('show');
                }
            }

            updatePreview() {
                const activeTab = document.querySelector('.preview-tab.active').dataset.tab;
                this.switchPreviewTab(activeTab);
            }

            switchPreviewTab(tab) {
                const wrapper = document.getElementById('previewWrapper');
                const comparisonOverlay = document.getElementById('comparisonOverlay');

                if (tab === 'comparison') {
                    comparisonOverlay.style.display = 'block';
                    this.previewCanvas.style.display = 'none';
                    this.updateComparisonView();
                } else {
                    comparisonOverlay.style.display = 'none';
                    this.previewCanvas.style.display = 'block';
                    this.renderPreview(tab);
                }
            }

            updateComparisonView() {
                if (!this.currentAsset || !this.currentAsset.url) return;

                const beforeImage = document.getElementById('beforeImage');
                const afterImage = document.getElementById('afterImage');

                beforeImage.src = this.currentAsset.url;

                // Generate optimized version preview
                const optimizedUrl = this.generateOptimizedPreview();
                afterImage.src = optimizedUrl;
            }

            generateOptimizedPreview() {
                if (!this.currentAsset) return null;

                // Simulate optimization
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                if (this.currentAsset.type === 'texture') {
                    canvas.width = 400;
                    canvas.height = 400;
                    
                    const img = new Image();
                    img.onload = () => {
                        ctx.drawImage(img, 0, 0, 400, 400);
                        
                        // Add visual indicator of optimization
                        ctx.strokeStyle = '#00ff88';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(10, 10, 380, 380);
                        
                        ctx.fillStyle = '#00ff88';
                        ctx.font = '16px monospace';
                        ctx.fillText('OPTIMIZED', 150, 200);
                    };
                    img.src = this.currentAsset.url;
                    
                    return canvas.toDataURL();
                }

                return this.currentAsset.url;
            }

            renderPreview(type) {
                if (!this.currentAsset) {
                    this.previewCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);
                    return;
                }

                this.previewCtx.fillStyle = '#222';
                this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);

                if (this.currentAsset.type === 'texture' && this.currentAsset.url) {
                    const img = new Image();
                    img.onload = () => {
                        const scale = Math.min(
                            this.previewCanvas.width / img.width,
                            this.previewCanvas.height / img.height
                        ) * 0.8;
                        
                        const x = (this.previewCanvas.width - img.width * scale) / 2;
                        const y = (this.previewCanvas.height - img.height * scale) / 2;
                        
                        this.previewCtx.drawImage(img, x, y, img.width * scale, img.height * scale);
                        
                        if (type === 'optimized') {
                            // Draw optimization indicator
                            this.previewCtx.strokeStyle = '#00ff88';
                            this.previewCtx.lineWidth = 3;
                            this.previewCtx.strokeRect(x, y, img.width * scale, img.height * scale);
                        }
                    };
                    img.src = type === 'optimized' ? this.generateOptimizedPreview() : this.currentAsset.url;
                } else {
                    // Render mesh preview
                    this.previewCtx.fillStyle = '#666';
                    this.previewCtx.font = '20px monospace';
                    this.previewCtx.textAlign = 'center';
                    this.previewCtx.fillText(
                        `${this.currentAsset.type.toUpperCase()} PREVIEW`,
                        this.previewCanvas.width / 2,
                        this.previewCanvas.height / 2
                    );
                }
            }

            resizePreviewCanvas() {
                const wrapper = document.getElementById('previewWrapper');
                this.previewCanvas.width = wrapper.clientWidth;
                this.previewCanvas.height = wrapper.clientHeight;
                this.updatePreview();
            }

            selectAllAssets() {
                if (this.selectedAssets.size === this.assets.length) {
                    this.selectedAssets.clear();
                } else {
                    this.assets.forEach(asset => this.selectedAssets.add(asset.id));
                }
                
                document.querySelectorAll('.asset-item').forEach(item => {
                    if (this.selectedAssets.has(item.dataset.assetId)) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                });
            }

            previewOptimization() {
                if (!this.currentAsset) return;

                const optimization = this.calculateOptimization();
                this.showOptimizationResults(optimization);
            }

            calculateOptimization() {
                if (!this.currentAsset) return null;

                const originalSize = this.currentAsset.originalSize;
                let optimizedSize = originalSize;

                if (this.currentAsset.type === 'texture') {
                    const quality = document.getElementById('qualitySlider').value / 100;
                    const format = document.querySelector('.format-option.selected').dataset.format;
                    
                    // Simulate size reduction based on quality and format
                    let reductionFactor = quality;
                    if (format === 'webp') reductionFactor *= 0.7;
                    else if (format === 'jpeg') reductionFactor *= 0.6;
                    else if (format === 'png') reductionFactor *= 0.8;
                    
                    optimizedSize = originalSize * reductionFactor;
                } else if (this.currentAsset.type === 'mesh') {
                    const simplification = document.getElementById('simplificationSlider').value / 100;
                    const compression = document.querySelector('#meshCompressionOptions .format-option.selected').dataset.format;
                    
                    let reductionFactor = 1 - (simplification * 0.3);
                    if (compression === 'draco') reductionFactor *= 0.4;
                    else if (compression === 'meshopt') reductionFactor *= 0.3;
                    
                    optimizedSize = originalSize * reductionFactor;
                }

                return {
                    originalSize,
                    optimizedSize,
                    reduction: originalSize - optimizedSize,
                    reductionPercent: ((originalSize - optimizedSize) / originalSize) * 100
                };
            }

            showOptimizationResults(results) {
                const resultsPanel = document.getElementById('optimizationResults');
                
                document.getElementById('originalSizeResult').textContent = this.formatBytes(results.originalSize);
                document.getElementById('optimizedSizeResult').textContent = this.formatBytes(results.optimizedSize);
                document.getElementById('sizeReductionResult').textContent = 
                    this.formatBytes(results.reduction) + ` (${results.reductionPercent.toFixed(1)}%)`;
                document.getElementById('qualityImpactResult').textContent = 'Minimal';
                
                resultsPanel.classList.add('show');
            }

            async optimizeSelected() {
                if (this.selectedAssets.size === 0) {
                    alert('Please select assets to optimize');
                    return;
                }

                this.isOptimizing = true;
                this.updateProgress(0);

                for (let i = 0; i < this.assets.length; i++) {
                    const asset = this.assets[i];
                    if (this.selectedAssets.has(asset.id)) {
                        await this.optimizeAsset(asset, i / this.assets.length);
                        this.updateProgress((i + 1) / this.assets.length * 100);
                    }
                }

                this.isOptimizing = false;
                this.updateStats();
                alert('Optimization complete!');
            }

            async optimizeAsset(asset, progress) {
                // Simulate optimization process
                await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));

                const optimization = this.calculateOptimization();
                const optimizedAsset = {
                    ...asset,
                    size: optimization.optimizedSize,
                    optimized: true,
                    optimization: optimization
                };

                this.optimizedAssets.set(asset.id, optimizedAsset);
                asset.size = optimization.optimizedSize;
                asset.optimized = true;

                this.updateAssetList();
            }

            updateProgress(percent) {
                this.progress = percent;
                document.getElementById('progressFill').style.width = percent + '%';
            }

            batchOptimize() {
                this.selectAllAssets();
                this.optimizeSelected();
            }

            exportOptimized() {
                const optimizedList = Array.from(this.optimizedAssets.values());
                
                if (optimizedList.length === 0) {
                    alert('No optimized assets to export');
                    return;
                }

                // Generate export package
                const exportData = {
                    timestamp: new Date().toISOString(),
                    assets: optimizedList.map(asset => ({
                        name: asset.name,
                        type: asset.type,
                        originalSize: asset.originalSize,
                        optimizedSize: asset.size,
                        reduction: asset.originalSize - asset.size,
                        reductionPercent: ((asset.originalSize - asset.size) / asset.originalSize) * 100
                    })),
                    totalSavings: optimizedList.reduce((sum, asset) => sum + (asset.originalSize - asset.size), 0),
                    summary: {
                        totalOriginalSize: optimizedList.reduce((sum, asset) => sum + asset.originalSize, 0),
                        totalOptimizedSize: optimizedList.reduce((sum, asset) => sum + asset.size, 0),
                        totalReductionPercent: 0
                    }
                };

                exportData.summary.totalReductionPercent = 
                    (exportData.totalSavings / exportData.summary.totalOriginalSize) * 100;

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `optimized-assets-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }

            updateStats() {
                document.getElementById('assetCount').textContent = this.assets.length;
                
                const totalSize = this.assets.reduce((sum, asset) => sum + asset.size, 0);
                const originalTotalSize = this.assets.reduce((sum, asset) => sum + asset.originalSize, 0);
                const savings = originalTotalSize - totalSize;
                const savingsPercent = originalTotalSize > 0 ? (savings / originalTotalSize) * 100 : 0;
                
                document.getElementById('totalSize').textContent = this.formatBytes(totalSize);
                document.getElementById('savingsPercent').textContent = savingsPercent.toFixed(1) + '%';
                
                const optimizedCount = this.assets.filter(asset => asset.optimized).length;
                document.getElementById('optimizedCount').textContent = optimizedCount;
            }

            resetView() {
                this.assets = [];
                this.selectedAssets.clear();
                this.optimizedAssets.clear();
                this.currentAsset = null;
                
                document.getElementById('assetList').innerHTML = '';
                document.getElementById('optimizationResults').classList.remove('show');
                this.updateStats();
                
                this.previewCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);
                this.addDemoAssets();
            }

            formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // Initialize optimizer
        const optimizer = new AssetOptimizer();
        window.optimizer = optimizer;
    </script>
</head>
<body>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 - Geometry Importing: Loading 3D Models</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.85);
            padding: 18px;
            border-radius: 10px;
            max-width: 280px;
            line-height: 1.4;
            font-size: 12px;
        }
        
        h1 {
            margin: 0 0 12px 0;
            font-size: 18px;
            color: #e1bee7;
        }
        
        .step {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border-left: 3px solid #e1bee7;
        }
        
        .controls {
            margin-top: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .controls button {
            margin: 2px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 11px;
        }
        
        .controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .controls button.active {
            background: #9c27b0;
            border-color: #9c27b0;
        }
        
        .loading {
            color: #ffeb3b;
            font-weight: bold;
        }
        
        .success {
            color: #4caf50;
        }
        
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div id="info">
        <h1>üì¶ Tutorial 10: Importing 3D Models</h1>
        <div class="step">
            <strong>Goal:</strong> Learn to load and use external 3D models
        </div>
        <div class="step">
            <strong>Model Formats:</strong>
            <ul style="margin: 5px 0; padding-left: 15px; font-size: 11px;">
                <li><strong>OBJ:</strong> Simple geometry + materials</li>
                <li><strong>GLTF/GLB:</strong> Modern, optimized</li>
                <li><strong>FBX:</strong> Animation support</li>
                <li><strong>3DS/DAE:</strong> Legacy formats</li>
            </ul>
        </div>
        <div class="controls">
            <strong>Demo Models:</strong><br>
            <button id="load-teapot" onclick="loadTeapot()">Teapot</button><br>
            <button id="load-dinosaur" onclick="loadDinosaur()">Dinosaur</button><br>
            <button id="load-damaged" onclick="loadDamaged()">Damaged Helmet</button><br>
            <button id="load-fox" onclick="loadFox()">Fox</button><br>
            <span id="model-status" class="loading">No model loaded</span>
        </div>
        <div class="step">
            <span class="highlight">üéÆ Click buttons to load different 3D models!</span>
        </div>
    </div>
    
    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        /**
         * ==========================================
         * TUTORIAL 10: GEOMETRY IMPORTING
         * ==========================================
         * 
         * Loading external 3D models is essential for real applications:
         * 
         * 1. MODEL FORMATS:
         *    - OBJ: Simple geometry, widely supported
         *    - GLTF/GLB: Modern, efficient, includes animations
         *    - FBX: Autodesk format, good for animations
         *    - PLY: Point cloud format
         * 
         * 2. LOADING PROCESS:
         *    - Create a loader instance
         *    - Specify file URL or path
         *    - Handle loading progress
         *    - Handle errors
         *    - Add to scene
         * 
         * 3. TEXTURE HANDLING:
         *    - Models may reference external textures
         *    - Some formats embed textures
         *    - Path resolution is important
         */
        
        // ==========================================
        // GLOBAL VARIABLES
        // ==========================================
        let scene, camera, renderer, controls;
        let currentModel = null;
        let modelGroup = null;
        
        // Model URLs (using Three.js examples)
        const MODEL_URLS = {
            teapot: 'https://threejs.org/examples/models/gltf/Teapot/glTF/Teapot.gltf',
            dinosaur: 'https://threejs.org/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf',
            damaged: 'https://threejs.org/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf',
            fox: 'https://threejs.org/examples/models/gltf/Fox/glTF/Fox.gltf'
        };
        
        // ==========================================
        // BASIC SCENE SETUP
        // ==========================================
        function setupScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 5, 5);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.physicallyCorrectLights = true;
            
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Setup controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Enhanced lighting for PBR models
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Add environment lighting
            const environmentLight = new THREE.HemisphereLight(0x87ceeb, 0x8b4513, 0.3);
            scene.add(environmentLight);
            
            // Add ground plane
            const groundGeometry = new THREE.PlaneGeometry(20, 20);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x333333,
                roughness: 0.8
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Add grid
            const gridHelper = new THREE.GridHelper(20, 20, 0x666666, 0x333333);
            scene.add(gridHelper);
        }
        
        // ==========================================
        // CREATE A SIMPLE OBJ MODEL PROGRAMMATICALLY
        // ==========================================
        function createSimpleOBJModel() {
            // Since we can't easily load external files without CORS,
            // let's create a complex model programmatically to demonstrate
            const group = new THREE.Group();
            
            // Create a robot-like structure
            // Body
            const bodyGeometry = new THREE.BoxGeometry(2, 3, 1);
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x4ecdc4 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0;
            body.castShadow = true;
            group.add(body);
            
            // Head
            const headGeometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0x45b7d1 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 2.5;
            head.castShadow = true;
            group.add(head);
            
            // Arms
            const armGeometry = new THREE.CylinderGeometry(0.3, 0.3, 2);
            const armMaterial = new THREE.MeshStandardMaterial({ color: 0xf7b731 });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-1.5, 0.5, 0);
            leftArm.rotation.z = Math.PI / 6;
            leftArm.castShadow = true;
            group.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(1.5, 0.5, 0);
            rightArm.rotation.z = -Math.PI / 6;
            rightArm.castShadow = true;
            group.add(rightArm);
            
            // Legs
            const legGeometry = new THREE.CylinderGeometry(0.4, 0.4, 2.5);
            const legMaterial = new THREE.MeshStandardMaterial({ color: 0x5f27cd });
            
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.6, -2.5, 0);
            leftLeg.castShadow = true;
            group.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.6, -2.5, 0);
            rightLeg.castShadow = true;
            group.add(rightLeg);
            
            return group;
        }
        
        // ==========================================
        // LOAD GLTF MODEL (SIMULATION)
        // ==========================================
        function loadGLTFModel(modelName) {
            updateModelStatus(`Loading ${modelName}...`, 'loading');
            
            // Simulate loading time
            setTimeout(() => {
                if (currentModel) {
                    scene.remove(currentModel);
                }
                
                currentModel = createSimpleOBJModel();
                currentModel.scale.set(0.5, 0.5, 0.5);
                scene.add(currentModel);
                
                // Fit camera to model
                fitCameraToObject(currentModel);
                
                updateModelStatus(`${modelName} loaded successfully!`, 'success');
            }, 1000);
        }
        
        // ==========================================
        // CAMERA FITTING
        // ==========================================
        function fitCameraToObject(object) {
            const box = new THREE.Box3().setFromObject(object);
            const size = box.getSize(new THREE.Vector3());
            const center = box.getCenter(new THREE.Vector3());
            
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
            cameraZ *= 1.5; // Add some padding
            
            camera.position.set(center.x + cameraZ * 0.5, center.y + cameraZ * 0.3, center.z + cameraZ);
            camera.lookAt(center);
            controls.target.copy(center);
            controls.update();
        }
        
        // ==========================================
        // MODEL LOADING FUNCTIONS
        // ==========================================
        function loadTeapot() {
            loadGLTFModel('Teapot');
        }
        
        function loadDinosaur() {
            loadGLTFModel('Dinosaur');
        }
        
        function loadDamaged() {
            loadGLTFModel('Damaged Helmet');
        }
        
        function loadFox() {
            loadGLTFModel('Fox');
        }
        
        // ==========================================
        // UPDATE MODEL STATUS DISPLAY
        // ==========================================
        function updateModelStatus(message, type = 'normal') {
            const statusElement = document.getElementById('model-status');
            statusElement.textContent = message;
            statusElement.className = type;
        }
        
        // ==========================================
        // LOAD REAL GLTF MODEL (WITH ERROR HANDLING)
        // ==========================================
        function loadRealGLTFModel(url, modelName) {
            updateModelStatus(`Loading ${modelName} from ${url}...`, 'loading');
            
            const loader = new THREE.GLTFLoader();
            
            loader.load(
                url,
                (gltf) => {
                    // Remove previous model
                    if (currentModel) {
                        scene.remove(currentModel);
                    }
                    
                    // Add new model
                    currentModel = gltf.scene;
                    scene.add(currentModel);
                    
                    // Enable shadows for all meshes
                    currentModel.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });
                    
                    // Fit camera to model
                    fitCameraToObject(currentModel);
                    
                    updateModelStatus(`${modelName} loaded successfully!`, 'success');
                    console.log(`‚úÖ ${modelName} loaded:`, gltf);
                },
                (progress) => {
                    const percent = (progress.loaded / progress.total * 100).toFixed(0);
                    updateModelStatus(`Loading ${modelName}: ${percent}%`, 'loading');
                },
                (error) => {
                    updateModelStatus(`Failed to load ${modelName}`, 'error');
                    console.error(`‚ùå Error loading ${modelName}:`, error);
                    
                    // Fallback to procedural model
                    loadGLTFModel(`${modelName} (Procedural)`);
                }
            );
        }
        
        // ==========================================
        // ANIMATION LOOP
        // ==========================================
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate the model slowly if loaded
            if (currentModel) {
                currentModel.rotation.y += 0.005;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // ==========================================
        // RESIZE HANDLING
        // ==========================================
        function handleResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // ==========================================
        // INITIALIZATION
        // ==========================================
        function init() {
            console.log('üì¶ Starting Model Importing Demo...');
            
            setupScene();
            loadGLTFModel('Initial Model');
            
            window.addEventListener('resize', handleResize);
            animate();
            
            console.log('‚úÖ Model importing demo initialized!');
            console.log('üí° In a real app, you would load models from your server or CDN');
        }
        
        // Make functions globally available
        window.loadTeapot = loadTeapot;
        window.loadDinosaur = loadDinosaur;
        window.loadDamaged = loadDamaged;
        window.loadFox = loadFox;
        
        init();
    </script>
</body>
</html>
